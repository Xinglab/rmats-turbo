# Common Workflow Language (CWL) for rMATS

## Dependencies

* Dependencies for generating the CWL ([https://www.commonwl.org](https://www.commonwl.org)) can be installed with
```
conda create --prefix ./rmats_cwl_conda_env
conda activate ./rmats_cwl_conda_env
conda install -c conda-forge -c bioconda --file ./conda_requirements.txt
```

## Generate CWL

* [pl_rMATS_bam.R](pl_rMATS_bam.R) is implemented with [https://github.com/rworkflow/Rcwl](https://github.com/rworkflow/Rcwl)
* A CWL file that is compatible with Cavatica can be generated by:
  + Run `R` interactively
```
library('Rcwl')
source('pl_rMATS_bam.R')
writeCWL(workflow, prefix= "rMATS_bam", outdir = "rcwl_out")
```
  + Exit R (ctrl-d)
  + Then on the command line
```
python pack_cwl_for_sbg.py --in-cwl ./rcwl_out/rMATS_bam.cwl --out-cwl ./rMATS_bam_packed.cwl
```

## Run on Cavatica

* Upload the generated `rMATS_bam_packed.cwl` to Cavatica as a new workflow app
* The contents of the CWL file can be pasted into the "Code" section of the Cavatica workflow editor
* In the "App Info" tab of the editor, the "name" field needs to be set (example: `rMATS_bam`)
